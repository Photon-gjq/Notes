\documentclass[UTF8, a4paper]{ctexart}

\usepackage{geometry}
\usepackage{titling}
\usepackage{titlesec}
\usepackage{paralist}
\usepackage{footnote}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{physics}
\usepackage{siunitx}
\usepackage{tikz-feynhand}
\usepackage[colorlinks, linkcolor=black, anchorcolor=black, citecolor=black]{hyperref}
\usepackage{prettyref}

\geometry{left=3.28cm,right=3.28cm,top=2.54cm,bottom=2.54cm}
\titlespacing{\paragraph}{0pt}{1pt}{10pt}[20pt]
\setlength{\droptitle}{-5em}
\preauthor{\vspace{-10pt}\begin{center}}
\postauthor{\par\end{center}}

\newcommand*{\ee}{\mathrm{e}}
\newcommand*{\ii}{\mathrm{i}}
\newcommand*{\const}{\mathrm{const}}
\newcommand*{\natnums}{\mathbb{N}}
\newcommand*{\reals}{\mathbb{R}}
\newcommand*{\complexes}{\mathbb{C}}
\DeclareMathOperator{\timeorder}{T}
\newcommand*{\ogroup}[1]{\mathrm{O}(#1)}
\newcommand*{\sogroup}[1]{\mathrm{SO}(#1)}
\DeclareMathOperator{\legpoly}{P}

\newrefformat{sec}{第\ref{#1}节}
\newrefformat{note}{注\ref{#1}}
\newrefformat{fig}{图\ref{#1}}
\renewcommand{\autoref}{\prettyref}

\newcommand{\concept}[1]{\underline{#1}}
\renewcommand{\emph}{\textbf}

\tikzfeynhandset{
    every boldphoton@@/.style={
    /tikz/draw=none,
    /tikz/postaction={
            /tikz/draw,
            /tikz/double,
            /tikz/line width = \feynhandlinesize,
            /tikz/decoration={
                complete sines,
                amplitude=3\feynhandlinesize,
                segment length=7.5\feynhandlinesize,
            },
            /tikz/decorate=true,
        },
    },
    every boldphoton/.style={/tikzfeynhand/every boldphoton@@/.append style={#1}},
    boldphoton/.style={
    /tikzfeynhand/every boldphoton@@,
    }
}

\title{非线性光学}
\author{吴晋渊}

\begin{document}

\maketitle

\section{何时非线性效应出现？}

当一束光照射在介质上时，分子、原子中的电子会离开其原有位置，并受到一个回复力。
如果光照较弱，电子总是可以看成简谐振子，从而电子自己发出的电磁辐射的频率和入射光的频率是完全一样的，电磁辐射的幅度正比于入射光的幅度，于是可以写出外场和总场之间的线性关系，从而得到所谓的\concept{线性光学}。
但是，如果光照非常强，非线性效应就会出现。强激光光源的出现让对这一领域的实验研究成为可能。

\subsection{激光}

本节首先介绍强光如何能够产生。

如果我们能够有一个长期保持粒子数反转的系统（显然需要持续的能量输入），那么向这个系统入射一束光将会产生更强的出射光，因为会有受激发射，且受激发射出的光和入射光是非常相干的。
因此我们向粒子数反转的系统注入的能量可以用于增强入射光，并且如果入射光相干性非常好，那么出射光也保持非常好的相干性，并且比入射光更亮，这就是\concept{激光}。

最简单的方案——使用一个二能级系统，直接通过一次入射来得到激光——是不现实的，因为此时大量的能量会消耗在保持粒子数反转上，而为了 TODO
两个可能的改进：将粒子数反转的系统放在一个四壁强反射的腔体内，从而光束可以来回走，不断被增强，并且使用一个三能级系统，其中间能级是一个亚稳态，从而很容易制造粒子数反转。
可以在腔体的一个地方“开洞”——比如说让反射率稍微低一些——让一些光子泄露出来，激光就从这里被导出。

多光子过程：可以避免光学屏障，以及排除荧光本底

\section{非线性光学过程的经典模型}

\subsection{非线性谐振子模型}

本节将材料当成一系列谐振子的组合，并且暂时不考虑谐振子之间的相互作用。
这是相对合理的，因为能够长距离传输光的介质一般不是金属，从而电子是相对定域的。
然而，这并不意味着我们的理论是自由的。
我们知道一个标准的经典谐振子可以用
\begin{equation}
    m \dv[2]{x}{t} + m \gamma \dv{x}{t} + m \omega_0^2 x = q E
\end{equation}
来描述，而如果我们加上诸如$x^3$这样的项，即让谐振子的回复力为非线性的，就可以造成谐振子模式发生自相互作用。
我们讨论的问题的能量都并不高，谐振子运动不会特别快，因此可以认为谐振子只产生电场，并且其方式为“电偶极子产生库伦场”。
用作用量表示，就是% TODO:有误，这里的关键在于qxE可以给出电场对电荷的作用，但是是否能够给出电荷对电场的作用？？或者说，电场和电荷的相互作用拉氏量或是哈密顿量要怎么写？？
\[
    S = \int \dd{t} \left( \frac{1}{2} m \dot{x}^2 - \frac{1}{2} k x^2 + \text{higher order $x^n$} + qxE \right).
\]
现在积掉谐振子，就能够得到非线性的光子-光子过程，即多个光子和一或是一个光子分裂为多个光子。

\subsubsection{二阶非线性极化}

我们现在在谐振子能量中加入一个三次项，即在运动方程中加入一个二次回复力：
\begin{equation}
    m \dv[2]{x}{t} + m \gamma \dv{x}{t} + m \omega_0^2 x + m a x^2 = q E.
    \label{eq:x3-eq}
\end{equation}
这相当于在能量中加入了一个$\frac{1}{3} m a x^3$项。
我们实际上是要从电场计算$x$（从$x$计算响应电场的公式是显然的，就是大量偶极子加总为$\vb*{P}$然后从$\vb*{P}$出发算电场）。

对这个问题的标准的处理是微扰求解微分方程，但是实际上可以使用费曼图分析这个问题。由于只考虑经典情况，无需计算圈图。
“经典情况”到底指的是什么需要进一步说明：在经典情况下我们没有二次量子化，粒子图景的经典理论和场的图景的经典理论还不一样。
粒子图景下运动方程是关于各个粒子的位置和动量的，入射和出射外线没有任何限制。
场的图景下，我们求解系统的基本自由度（在这里是电场和谐振子坐标）的运动方程，得到场变量随时间的变化情况，即实际上在求解$\expval*{\phi}$，因此只能有一条出射外线，入射外线应当被当成外源。
在经典极限下这两种图景不会造成太大差别：同一张图的外线数目是固定的，在场的图景下，出射外线多了外源就少，由于我们要求场强满足$\phi / \hbar \ll 1$（但与此同时能标又没有高到多顶角图非常重要，从而圈图修正有必要计算），外源较少的过程是非常不重要的。

我们采用后一种图景，因为我们实际上就是在微扰求解\eqref{eq:x3-eq}。
将电磁场和带有$x^3$形势能的非线性振子耦合，则费曼图中应该有\autoref{fig:x3-vertex}和\autoref{fig:light-osci-couple}两种基本元件。
由于电场和谐振子的耦合是完全线性的（并且由于谐振子是一个没有空间分布的点，实际上耦合项就是电偶极子能量），且我们关心的是“非线性介质中有哪些光学过程”，可以将电场暂时当成背景场，于是\autoref{fig:light-osci-couple}应该被\autoref{fig:external-field}取代。
例如，我们只需要分析一阶过程\autoref{fig:first-order-x3-external}就能知道\autoref{fig:first-order-x3-photon}的来源——如果$E$让$x$产生非线性响应，那就有光子分裂和合并的过程。

费曼规则可以很容易地写出：（我们认为频率为$\omega$的成分携带$\ee^{- \ii \omega t}$因子）
\begin{itemize}
    \item 传播子为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag [plain, mom={$\omega$}] (a) to (b); 
            \end{feynhand}
        \end{tikzpicture} = \frac{\ii}{m (\omega^2 + \ii \gamma \omega - \omega_0^2)}.
    \]
    \item 顶角为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1,-1); \vertex (b) at (1,-1); \vertex (c) at (0,1);
                \vertex (o) at (0,0); 
                \propag [plain] (a) to (o);
                \propag [plain] (b) to (o); 
                \propag [plain] (c) to (o);    
            \end{feynhand}
        \end{tikzpicture} = - \ii 2 m a \cdot 2\pi \delta(\sum \omega).
    \]
    注意正常情况下$x^3$相互作用要配一个$1/3!$的因子但是这里只有$1/3$，因此顶角实际上是$2ma$而不是$ma$。
    \item 外源为
    \[
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (0, 0){};
                \vertex (b) at (1, 0);
                \propag [plain, mom={$\omega$}] (a) to (b); 
            \end{feynhand}
        \end{tikzpicture} = \ii q E(\omega).
    \]
    请注意这里没有负号，而$x^3$是负号的，这是因为均匀电场会倾向于把谐振子拉向无穷远处而回复力则会将谐振子拉回来。
    本节采取的傅里叶变换约定为
    \[
        E(t) = \int \dd{\omega} E(\omega) \ee^{- \ii \omega t},
    \]
    没有加入$2\pi$是因为很多时候入射光并不是连续谱，而是离散的几个频域分量加起来。
\end{itemize}

\begin{figure}
    \centering
    \subfigure[$x^3$自相互作用顶角]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1,-1); \vertex (b) at (1,-1); \vertex (c) at (0,1);
                \vertex [dot] (o) at (0,0) {}; 
                \propag [plain] (a) to (o);
                \propag [plain] (b) to (o); 
                \propag [plain] (c) to (o);    
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:x3-vertex}
    }
    \subfigure[光子让谐振子被激发]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-1, 1.5);
                \vertex (b) at (0, 1.5);
                \vertex (c) at (1, 1.5);
                \propag [photon] (a) to (b);
                \propag [plain] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:light-osci-couple}
    }
    \subfigure[外源驱动谐振子，即\autoref{fig:light-osci-couple}中的光子被当成无动力学的外场后得到的图形]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag [plain] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:external-field}
    }
    \caption{加入$\frac{1}{3} m a x^3$势能之后的费曼图元件}
\end{figure}

\begin{figure}
    \centering
    \subfigure[外场导致的响应的一阶近似]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (-1,-1) {};
                \vertex [crossdot] (b) at (1,-1) {}; 
                \vertex (c) at (0,1);
                \vertex (o) at (0,0) ; 
                \propag [plain, mom={$\omega_1$}] (a) to (o);
                \propag [plain, mom={$\omega_2$}] (b) to (o); 
                \propag [plain, mom={$\omega_1 + \omega_2$}] (o) to (c);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:first-order-x3-external}
    }
    \subfigure[\autoref{fig:first-order-x3-external}导致的非线性光学过程]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a0) at (-1.5, -1.5);
                \vertex (a) at (-0.5,-0.5);
                \vertex (b0) at (1.5, -1.5);
                \vertex (b) at (0.5,-0.5); 
                \vertex (c) at (0,0.5);
                \vertex (c0) at (0, 1.5);
                \vertex (o) at (0,0) ; 
                \propag [photon, mom={$\omega_1$}] (a0) to (a);
                \propag [plain] (a) to (o);
                \propag [photon, mom={$\omega_2$}] (b0) to (b);
                \propag [plain] (b) to (o); 
                \propag [plain] (o) to (c);
                \propag [photon, mom={$\omega_1 + \omega_2$}] (c) to (c0);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:first-order-x3-photon}
    }
    \caption{一阶过程}
    \label{fig:x3-first-order}
\end{figure}

据此，线性响应（零阶，没有发生任何非线性效应）为
\begin{equation}
    x_1(\omega) = \ii q E(\omega) \frac{\ii}{m (\omega^2 + \ii \gamma \omega - \omega_0^2)} = \frac{q / m}{\omega_0^2 - \omega^2 - \ii \gamma \omega} E(\omega).
\end{equation}
一阶过程（即\autoref{fig:first-order-x3-external}）给出如下修正：
\begin{equation}
    \begin{aligned}
        x_2(\omega) &= \frac{1}{2} \int \omega_1 \int \omega_2 (\ii q E(\omega_1)) (\ii q E(\omega_2)) \frac{\ii}{m(\omega_1^2 + \ii \gamma \omega_1 - \omega_0^2)} \frac{\ii}{m(\omega_2^2 + \ii \gamma \omega_2 - \omega_0^2)} \\ 
        &\quad \quad \times (-\ii 2 m a) \frac{\ii}{(m(\omega_1 + \omega_2)^2 + \ii \gamma (\omega_1 + \omega_2) - \omega_0^2)} 2\pi \delta(\omega_1 + \omega_2 - \omega) \\
        &= \int \dd{\omega_1} \int \dd{\omega_2} \frac{a (q / m)^2}{(\omega_1^2 + \ii \gamma \omega_1 - \omega_0^2) (\omega_2^2 + \ii \gamma \omega_2 - \omega_0^2) (\omega^2 + \ii \gamma \omega - \omega_0^2)}  \\
        &\quad \quad \times 2\pi \delta(\omega_1 + \omega_2 - \omega) \times E(\omega_1) E(\omega_2).
    \end{aligned} 
    \label{eq:continuous-x3-first-order}
\end{equation}
这里需要注意一点：\autoref{fig:first-order-x3-external}中外场出现了两次，而
\[
    E(t)^2 = \int \dd{\omega_1} \int \dd{\omega_2} E(\omega_1) E(\omega_2) \ee^{-\ii (\omega_1 + \omega_2) t},
\]
如果$\omega_1 \neq \omega_2$那么$E(\omega_1) E(\omega_2)$项实际上会被求和两次；同样，此时\eqref{eq:continuous-x3-first-order}中的$E(\omega_1) E(\omega_2)$项也会被求和两次。
直观地看，外场是给定的而不能随意交换，所以\autoref{fig:first-order-x3-external}中的两个外场从左到右为$\omega_1$和$\omega_2$的图和从左到右为$\omega_2$和$\omega_1$的图虽然给出一样的结果，但是是两张图，不能看成一张图，它们加起来会导致因子$2$出现。
如果我们令$E(t)$实际上只有两个频率分量，这一点会显得尤其明显。

现在我们采取更加常规的，微扰求解微分方程的做法。费曼图计算已经告诉我们主要的光学过程来自\autoref{fig:first-order-x3-external}。
因此，我们将输入的$E$设置为
\begin{equation}
    E = E_1 (\ee^{\ii \omega_1 t} + \ee^{-\ii \omega_1 t}) + E_2 (\ee^{\ii \omega_2 t} + \ee^{-\ii \omega_2 t}), 
    \label{eq:input-two-freq-e}
\end{equation}
做展开
\begin{equation}
    x = x_1 + x_2 + \ldots, \quad x_n \sim E^{n },
\end{equation}
并记
\begin{equation}
    x_i = \sum_n x_i(\omega_n) + \text{c.c.}.
\end{equation}
线性项$x_1$由
\[
    m \ddot{x}_1 + m \gamma \dot{x_1} +  m \omega_0^2 x_1 = q E
\]
给出，为
\begin{equation}
    x_1(\omega_1) = \frac{(q/m) E_i}{\omega_0^2 } \ee^{-\ii \omega_n t},
\end{equation}
二阶项由
% TODO:懒得写了
这些项分别称为：
\begin{itemize}
    \item \concept{和频（SFG, sum frequency generation）}，
    \item \concept{差频（DFG, difference frequency generation）}，
    \item \concept{倍频（SHG, second harmonic generation）}，
    \item \concept{光学整流（OR, optic rectification）}（因为输入交流波而得到直流波，那当然是整流了）。
\end{itemize}
倍频是和频的特殊情况，光学整流是差频的特殊情况。当然，直接将\eqref{eq:input-two-freq-e}代入\eqref{eq:continuous-x3-first-order}也能够得到这些过程。

乍一看，费曼图方法不仅能够得到两个光子合并为一个光子的过程，也能够得到一个光子分裂成两个光子的过程（所谓的\concept{SPDC过程（Spontaneous parametric down-conversion）}，也称为\concept{OPG过程（Optical parametric generation）}），但是我们后面将看到，微分方程方法似乎只能给出两个光子合并为一个光子的过程——如果我们在$E$中放入只有一个频率$\omega_0$的波，那么非线性效应似乎只会给出$\omega=0$和$\omega=2\omega_0$两种波。
但是其实这里并没有矛盾：SPDC过程需要两条出射外线；如前所述，我们采用场的图景，由于我们采用微分方程的写法，即从$E$求解$x$（其实是$\expval*{x}$），然后用“谐振子位置的偏离导致极化电场产生”计算总电场的变化，对$x$也要采用场的图景，所以的确只应该考虑只有一条外线的费曼图。
这暗示着SPDC过程实际上是非常弱的（本该如此，和频过程的振幅正比于$E^2$而SPDC过程的振幅正比于$E$），因此在经典图景下这个过程根本就不会出现。%
\footnote{
    从这里也可以看出光学中量子理论的重要性，即使我们讨论的能标自始至终都没有高到让只有QED才有的过程（如四光子等效相互作用）出现。
    经典理论对电磁波的描述是非常粗糙的：如果我们要描述一个物理状态中有两种不同频率的光子，应该怎么做？
    在经典理论中只有一种方法：设
    \[
        \vb*{E} = \vb*{E}_1 \ee^{\ii \omega_1 t} + \vb*{E}_2 \ee^{\ii \omega_2 t} + \text{c.c.}.
    \]
    现在如果要将从一个单频波到以上状态的过程画成费曼图，由于只能画一条外线的图，势必只能画出$\omega_0 \to \omega_1$和$\omega_0 \to \omega_2$两个图，然后能量就不守恒了。
}%

这并不是说SPDC过程——或者说OPG过程——在经典近似下完全看不到，因为我们可以在OPG过程后面再放一个DFG过程。
DFG过程也可以称为\concept{OPA过程（Optical parametric amplification）}，因为它让入射的两束光的一束变弱而另一束变强。
例如，设我们希望将一束频率为$\omega_1$的光分裂成两束光，频率分别是$\omega_2$和$\omega_3$。
我们可以将一个有二阶非线性极化的光学晶体放在一个内壁对频率为$\omega_2$和$\omega_3$的反射率很高的谐振腔中。
按照后面会提到的\eqref{eq:sfg-intensity}，如果有相位匹配条件成立，那么$\omega_1 \to \omega_2 + \omega_3$的OPG过程转化效率很高（在那里是SFG过程效率很高，这里就是OPG过程转化效率很高），于是产生足够强的$\omega_2$光束和$\omega_3$光束，这些光束被谐振腔反射回来，回到非线性晶体内部，于是发生很强的OPA过程。
因此，我们仅仅通过一束单频入射光就得到了两束不同频率的出射光。
% TODO：怎么定量算？
在经典理论中OPA过程是允许的，因此时间反演对称性并没有丧失：的的确确可以有光子的分裂。
但是，经典理论中所有电磁波模式上的光子都是足够多的，因此从“完全没有光子”到“有一个光子”的过程在经典理论中无法被描述。这就是OPG过程看不到的原因。

\begin{figure}
    \centering
    \subfigure[外场导致的响应的二阶近似]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex [crossdot] (a) at (-1,-1) {};
                \vertex [crossdot] (b) at (1,-1) {}; 
                \vertex (c) at (0,1);
                \vertex (o) at (0,0) ;
                \vertex [crossdot] (e) at (1, 2) {};
                \vertex  (f) at (-1, 2) ; 
                \propag [plain, mom={$\omega_1$}] (a) to (o);
                \propag [plain, mom={$\omega_2$}] (b) to (o); 
                \propag [plain, mom={$\omega_1 + \omega_2$}] (o) to (c);
                \propag [plain, mom={$\omega_3$}] (e) to (c);
                \propag [plain, mom={$\omega_1 + \omega_2 + \omega_3$}] (c) to (f);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:second-order-x3-external}
    }
    \subfigure[\autoref{fig:second-order-x3-external}导致的非线性光学过程]{
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a0) at (-1.5, -1.5);
                \vertex (a) at (-0.5,-0.5);
                \vertex (b0) at (1.5, -1.5);
                \vertex (b) at (0.5,-0.5); 
                \vertex (c) at (0,0.5);
                \vertex (o) at (0,0) ; 
                \vertex (d) at (0.5, 1);
                \vertex (e) at (-0.5, 1);
                \vertex (d0) at (1.5, 2);
                \vertex (e0) at (-1.5, 2);
                \propag [photon, mom={$\omega_1$}] (a0) to (a);
                \propag [plain] (a) to (o);
                \propag [photon, mom={$\omega_2$}] (b0) to (b);
                \propag [plain] (b) to (o); 
                \propag [plain] (o) to (c);
                \propag [plain] (c) to (e);
                \propag [plain] (c) to (d);
                \propag [photon, mom={$\omega_3$}] (d0) to (d);
                \propag [photon, mom={$\omega_1 + \omega_2 + \omega_3$}] (e) to (e0);
            \end{feynhand}
        \end{tikzpicture}
        \label{fig:second-order-x3-photon}
    }
    \caption{二阶过程}
    \label{fig:x3-second-order}
\end{figure}

还可以进一步往上计算微扰。例如，二阶微扰将给出\autoref{fig:x3-second-order}。
这里给出的四光子相互作用和\autoref{fig:first-order-x3-photon}产生的等效四光子相互作用不同，后者需要两个光子先合并，产生的光子传播一会，然后再和另一个光子合并。
\autoref{fig:second-order-x3-photon}给出的四光子相互作用是直截了当的。

我们来对各阶微扰的量级做一个估计。如果$\omega$和$\omega_0$比较接近，那么微扰论根本就不适用：此时共振发生，$x$是非常大的，可能高阶修正比低阶修正还大。
此时需要从头做光和物质耦合的计算而不能使用加入微弱非线性因素的振子模型。
如果$\omega$远大于$\omega_0$，我们将得到等离子体，此时彼此无关的、振幅不大的振子的图像更加失效了，可能晶格都已经被破坏了，电子的运动状况主要受电场控制。
在这两种情况下本节给出的非线性振子模型都不适用。（等离子体情况下有另一个非线性来源，即协变导数的输运项；见后文）
对$\omega \ll \omega_0$的情况，线性响应的量级为
\[
    x_1 \sim \frac{(q/m) E}{\omega_0^2},
\]
而
\[
    x_2 \sim \frac{a (q/m)^2 E^2}{\omega_0^6},
\]
因此
\begin{equation}
    \frac{x_2}{x_1} \sim \frac{a q E}{m \omega_0^4}.
\end{equation}
设原子对电子的束缚电场的量级为$E_\text{atom}$，即
\[
    q E_\text{atom} \sim m \omega_0^2 x .
\]
$x$的量级具体有多大是不确定的。将$x_1$和$x_2$简单地加起来可能是不明智的，因为频率不同。
我们不妨采取一个非常极端的假设，认为线性回复力和非线性回复力已经一样大了（如果非线性回复力很小，那么当然只需要计算一阶图），此时
\[
    m \omega_0^2 x \sim m a x^2,
\]
于是
\[
    q E_\text{atom} \sim m \omega_0^2 \frac{\omega_0^2}{a},
\]
最后
\begin{equation}
    \frac{x_2}{x_1} \sim \frac{E}{E_\text{atom}}.
\end{equation}
通常原子内部电场的数量级为\SI{3e8}{V/m}，因此即使认为非线性效应和线性效应一样大，一般来说$x_2$也远小于$x_1$。
类似地实际上可以证明
\begin{equation}
    \frac{x_{n+1}}{x_n} \sim \frac{E}{E_\text{atom}}.
\end{equation}

\subsubsection{三阶非线性极化}

\subsection{自由电子气的输运项}

此时的非线性效应来自$(\vb*{v} \cdot \grad) \vb*{v}$

金属表面也能够产生二次谐波

\section{光学的非线性波动方程}

本节将从一个比较唯象的角度描述经典非线性光学——我们忽略所有微观细节，只是去解麦克斯韦方程组，不过在这里，$\vb*{P}$和$\vb*{E}$之间的关系不再是线性的。

\subsection{非线性波动方程的建立和微扰求解}

\subsubsection{均匀介质中的传播}

本节讨论均匀非线性介质中的光的传播。
以下我们用短直线代表极化$P$，用波浪线代表电场；后者的意义一目了然，前者和前面几节的意义其实也是一样的，因为无非有
\[
    \vb*{P} = N q \vb*{x},
\]
其中$N$为单位体积的谐振子数目。我们知道极化强度矢量可以产生一个电场。我们有波动方程
\[
    \curl{(\curl{\vb*{E}})} + \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{D}}{t} = 0,
\]
代入$\vb*{D}$的定义，就得到
\begin{equation}
    \curl{(\curl{\vb*{E}})} + \frac{1}{c^2} \pdv[2]{\vb*{E}}{t} = - \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\end{equation}
实际上，这就是“电流作为一个天线，发出电磁波”，只不过此时天线是由总电场驱动的，从而上式左边和右边都有$\vb*{E}$，并且由于$\vb*{P}$和$\vb*{E}$之间的关心是非线性的，上式关于$\vb*{E}$也是非线性的。
不过，从$\vb*{P}$到$\vb*{E}$的关系的确是完全线性的，因此可以使用
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = - \left( \curl{\curl{}} + \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}
\end{equation}
表示。这是$\vb*{P}$消灭而光子产生的过程，看起来非常直观：一个天线上的激发态消失了，取而代之的是天线发出来的光。
本节讨论的是均匀介质，我们可以认为$\grad{\rho_\text{p}}=0$，从而$\grad{\div{\vb*{P}}}=0$，从而就得到$\div{\vb*{E}} = 0$。这样一来我们要求解的就是
\begin{equation}
    - \laplacian \vb*{E} + \frac{1}{c^2} \pdv[2]{\vb*{E}}{t} = -\frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t},
\end{equation}
而
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\end{equation}

此外我们还有任意的形如
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (-0.8, 0.25) ;
                \vertex (b) at (-0.8, -0.25) ;
                \vertex (d) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (e) at (1, 0);

                \propag[photon] (a) to (c);
                \propag[photon] (b) to (c);
                \propag[photon] (d) to (c);
                \propag[plain] (c) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \epsilon_0 \chi^{(n)}_{i_1 i_2 \ldots i_n}
\end{equation}
的产生$\vb*{P}$的顶角，代表$n$阶非线性极化（一阶极化是线性的），使得
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (-0.8, 0.25) {};
                \vertex[crossdot] (b) at (-0.8, -0.25) {};
                \vertex (d) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (e) at (1, 0);

                \propag[photon] (a) to (c);
                \propag[photon] (b) to (c);
                \propag[photon] (d) to (c);
                \propag[plain] (c) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \epsilon_0 \vb*{\chi}^{(n)} : \vb*{E} \vb*{E} \cdots \vb*{E}.
\]
线性光学中只有一条入射线，非线性光学中可以有多条。

这就是非线性波动方程中的所有顶角了。我们马上可以发现一件事，就是虽然看起来$\vb*{P}$场能够有自能修正
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag[double] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \propag[plain] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \vertex (d) at (3, 0);
                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
                \propag[plain] (c) to (d);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + \cdots,
\]
但是，因为我们讨论的所有过程都以光子开始以光子结束，加上入射和出射线之后上式实际上是光的自能修正。因此实际上$\vb*{P}$只是一个辅助量，我们可以将
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \vertex (d) at (3, 0);
                \propag[photon] (a) to (b);
                \propag[plain] (b) to (c);
                \propag[photon] (c) to (d);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered}
\]
看成一个整体。当然，本该如此。

我们要求解外加电场下的总场。这就是说，要计算
\[
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} + 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \vertex (d) at (3, 0);
                    \propag[photon] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} + \cdots \\
        &+ \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (-0.8, 0.25) {};
                    \vertex[crossdot] (b) at (-0.8, -0.25) {};
                    \vertex (d) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (e) at (1, 0);
                    \vertex (f) at (2, 0);
    
                    \propag[photon] (a) to (c);
                    \propag[photon] (b) to (c);
                    \propag[photon] (d) to (c);
                    \propag[plain] (c) to (e);
                    \propag[photon] (e) to (f);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered}
    \end{aligned}
\]
请注意上式左边的源不是$\otimes$而是一个灰色圆圈，因为非线性效应的存在让我们不知道外源被用到了多少次。
上式直接计算当然是非常复杂的，我们做重求和，根据最后一个顶角是什么，可以将上式写成
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ .
    \end{aligned}
\end{equation}
当然，这就是
\[
    \vb*{E} = \vb*{E}_\text{ext} + \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right)^{-1} \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t} ,
\]
稍加变形就会发现实际上这就是
\[
    \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right) (\vb*{E} - \vb*{E}_\text{ext}) = \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}}{t}.
\]
求解出上式中的$\vb*{E}$就完全确定了外加电场下的总场。“外加电场”当然是一个不良定义的概念，但这是因为我们将$\otimes$的来源省去了；它可能来自介质中的电荷或是介质两边的极板（归根到底，也是一些电荷），无论如何不来自$\vb*{P}$，即它是“没有经过相互作用修正的”，从而
\[
    \left( \laplacian - \frac{1}{c^2} \pdv[2]{t} \right) \vb*{E}_\text{ext} = 0.
\]
如果将理论量子化，它就是入射的近乎自由的粒子。我们经常称外加电场为\concept{泵浦光}，因为它将材料中的电子激发。%
\footnote{
    只要满足这个形式的电场分量都有机会被称为泵浦光。因此这个概念的确有定义模糊的地方。它可以指代从空气射向介质的入射光，可以指代将空气-介质界面当成线性介质界面而获得的折射光，甚至我们不能排除它指代经过局域场修正之后的折射光。
    本节讨论均匀介质内部的宏观问题，因此泵浦光不是从空气到介质的入射光也不需要做局域场修正。
}%

不过，具体什么是“相互作用修正”仍然有选择的余地，如我们可以将线性极化（即$\vb*{P}$关于$\vb*{E}$是线性的那部分；从$\vb*{P}$到$\vb*{E}$的转换则完全是线性的）部分作为自能修正重求和，然后将经过线性极化修正的光束（也就是服从关于不等于$\epsilon_0$的$\epsilon$的线性麦克斯韦方程组的光束）重新定义为\begin{tikzpicture}
    \begin{feynhand}
        \vertex (a) at (0, 0);
        \vertex (b) at (1, 0);
        \propag[photon] (a) to (b);
    \end{feynhand}
\end{tikzpicture}，此时\begin{tikzpicture}
    \begin{feynhand}
        \vertex (a) at (0, 0);
        \vertex (b) at (1, 0);
        \vertex (c) at (2, 0);

        \propag[plain] (a) to (b);
        \propag[photon] (b) to (c);
    \end{feynhand}
\end{tikzpicture}也需要调整（原本的意思是总的$\vb*{P}$产生真空中电场的响应函数，现在的意思是（非线性的）$\vb*{P}$产生线性介质中电场的响应函数），引入$\epsilon_{ij}$张量，然后顶角只剩下一种，就有
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered} +
    \sum \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (-1.2, 0.5) {};
                \vertex[grayblob] (b) at (-1.2, -0.5) {};
                \vertex (f) at (0, -1) {$\ldots$};
                \vertex (c) at (0, 0);
                \vertex (d) at (0.75, 0);
                \vertex (e) at (1.5, 0);

                \propag[boldphoton] (a) to (c);
                \propag[boldphoton] (b) to (c);
                \propag[boldphoton] (f) to (c);
                \propag[plain] (c) to (d);
                \propag[photon] (d) to (e);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} \ ,
\end{equation}
即
\begin{equation}
    \left( \laplacian - \frac{\vb*{\epsilon}_\text{r} \cdot}{c^2} \pdv[2]{t} \right) (\vb*{E} - \vb*{E}_\text{ext}) = \left( \laplacian - \frac{\vb*{\epsilon}_\text{r} \cdot}{c^2} \pdv[2]{t} \right) \vb*{E} = \frac{1}{\epsilon_0 c^2} \pdv[2]{\vb*{P}_\text{NL}}{t},
    \label{eq:nonlinear-maxwell-eq}
\end{equation}
其中NL表示非线性。这样做的好处一目了然：线性极化相当于对光速做了一个修正，是可以严格处理的，从而可以将主要精力集中在非线性极化上。

一个在线性光学中也会出现的现象是\concept{局域场强化}。这个现象来自于，从$\vb*{P}$产生的电场在空间上可能有比较大的变化，我们关心的是空间平均过之后的电场，即只是从$\vb*{P}$产生的电场的低频傅里叶分量。
因此我们做分解
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{low $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex (a) at (0, 0);
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);

                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered},
\end{equation}
那么就有
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon, mom={$\text{low $k$}$}] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon, mom={$\text{low $k$}$}] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{low $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ .
    \end{aligned}
    \label{eq:non-linear-smooth-p-e}
\end{equation}
然而，在上式中与$\vb*{P}$有关的图中的入射电场却没有做这个动量截断。
其结果是我们无法单纯从上式计算经过动量截断的出射电场，即我们需要手动提供没做动量截断的入射电场。
由于入射电场通常只具有低频分量，即
\[
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon, mom={$\text{low $k$}$}] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[crossdot] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \propag[photon] (a) to (b);
            \end{feynhand}
        \end{tikzpicture} 
    \end{gathered},
\]
我们有
\[
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{high $k$}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.5, 0);
                    \propag[boldphoton] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon, mom={$\text{high $k$}$}] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton] (a) to (c);
                    \propag[boldphoton] (b) to (c);
                    \propag[boldphoton] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon, mom={$\text{high $k$}$}] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \ ,
    \end{aligned}
\]
于是就有
\begin{equation}
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} = \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1.25, 0);
                \propag[boldphoton, mom={$\text{low $k$}$}] (a) to (b);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered} + 
    \begin{gathered}
        \begin{tikzpicture}
            \begin{feynhand}
                \vertex[grayblob] (a) at (0, 0) {};
                \vertex (b) at (1, 0);
                \vertex (c) at (2, 0);
                \propag[plain] (a) to (b);
                \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
            \end{feynhand}
        \end{tikzpicture}
    \end{gathered}.
    \label{eq:local-field-enhancement-diagram}
\end{equation}
联立计算\eqref{eq:non-linear-smooth-p-e}和\eqref{eq:local-field-enhancement-diagram}（求解过程中很容易看到，虽然$\vb*{P}$是辅助量但是确实能够简化书写），就得到外场作用下的做了动量截断的$\vb*{E}$——实际上，由于宏观下我们讨论的“介质中电场”一般都是均一化的电场，我们将做了动量截断的$\vb*{E}$就称为$\vb*{E}$。
此时\eqref{eq:local-field-enhancement-diagram}应当理解为“靠近介质粒子时电场的局域增强”。
在这种视角下，有
\begin{equation}
    \begin{aligned}
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (1.6, 0);
                    \vertex (d) at (2.2, 0);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (b);
                    \propag[plain] (b) to (c);
                    \propag[photon] (c) to (d);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} +
        \sum \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (-1.2, 0.5) {};
                    \vertex[grayblob] (b) at (-1.2, -0.5) {};
                    \vertex (f) at (0, -1) {$\ldots$};
                    \vertex (c) at (0, 0);
                    \vertex (d) at (0.75, 0);
                    \vertex (e) at (1.5, 0);
    
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (c);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (b) to (c);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (f) to (c);
                    \propag[plain] (c) to (d);
                    \propag[photon] (d) to (e);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} \\
        &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[crossdot] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \propag[photon] (a) to (b);
                \end{feynhand}
            \end{tikzpicture} 
        \end{gathered} +
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} , \\
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton, mom={$\text{enhanced}$}] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} &= \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1.25, 0);
                    \propag[boldphoton] (a) to (b);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered} + 
        \begin{gathered}
            \begin{tikzpicture}
                \begin{feynhand}
                    \vertex[grayblob] (a) at (0, 0) {};
                    \vertex (b) at (1, 0);
                    \vertex (c) at (2, 0);
                    \propag[plain] (a) to (b);
                    \propag[photon, mom={$\text{high $k$}$}] (b) to (c);
                \end{feynhand}
            \end{tikzpicture}
        \end{gathered}.
    \end{aligned}
\end{equation}

\subsubsection{边界条件}

边界，反射，折射：在线性的折射、反射上引入三个相互作用，一个是介质内部的光子-光子和频和差频，一个是入射端，介质内部两个光子打在边界上然后返回形成一个光子，一个是出射端，两个光子打在边界上然后一起出射。

\subsubsection{哪些解是重要的？}

非线性光学和线性光学非常不同的地方是，在线性光学中，给定一个时谐的（并且通常是平面波的，因为介质一般都很大，近似空间平移不变）泵浦光，计算入射导致的响应以及总电场，我们就得到了一个\emph{稳定的}模式；一个任意的入射波传入介质后的行为可以直接根据入射波在各个模式上的分量计算出来。
这意味着在线性光学中我们无需为任意的泵浦光求解麦克斯韦方程：只需要得到线性波动方程的所有振动模式就可以，各个振动模式的形状决定了这个光学系统的全部信息；场论上，这是自由场的情况。
非线性光学则不同，输出和激励并没有简单的线性关系。不过实际上，这并不意味着我们真的需要为所有的泵浦场独立地从头求解非线性波动方程。

首先，我们看到\eqref{eq:nonlinear-maxwell-eq}相对于时间是线性的。这意味着我们可以在时间频域求解\eqref{eq:nonlinear-maxwell-eq}。
也就是说，\eqref{eq:nonlinear-maxwell-eq}的全体时谐解已经包含了诸如“两个略有错开的波包打进介质将会如何反应”之类的瞬态问题的答案——只要入射波包不过于极端（如非常快导致介质来不及弛豫或是过强导致介质损坏等）。
在线性光学中这是常用的手段：例如，我们求解了时谐场在金属中的衰减，就可以不重新求解麦克斯韦方程就知道一个波包在金属中如何衰减，做一个傅里叶变换就行了：稳态问题提供了瞬态问题的答案，而前者往往更加容易做具体计算。
非线性光学中这个手段也是适用的。

其次，似乎存在这样一个疑难：在后文中我们将会求解诸如“泵浦光含有两个频率成分，它们都是平面波”这样的问题，但是实际上我们能够制备的光都是含有很多混杂的成分的，那么有什么理由保证后者发生的现象和前者一致？
例如，设泵浦光为
\[
    \vb*{E}^\text{ext} = \vb*{E}_1 \ee^{-\ii \omega_1 t} + \vb*{E}_2 \ee^{-\ii \omega_2 t} + \text{c.c.},
\]
微扰求解得到输出光为
\[
    \vb*{E} = \alpha^{(1)}(\omega_1) \vb*{E}_1 \ee^{-\ii \omega_1 t} + \alpha^{(1)}(\omega_2) \vb*{E}_2 \ee^{-\ii \omega_2 t} + \alpha^{(2)}(\omega_3 = \omega_1 + \omega_2) : \vb*{E}_1 \vb*{E}_2 \ee^{-\ii (\omega_1 + \omega_2) t} + \cdots + \text{c.c.}.
\]
现在如果我们要将泵浦光取为
\[
    \vb*{E}^\text{ext}(t) = \int \dd{\omega} \ee^{-\ii \omega t} \vb*{E}^\text{ext}(\omega),
\]
那么输出光$E(t)$不能通过简单地做一个傅里叶变换获得。
但其实我们可以效仿量子场论中的做法来解决这个问题。
我们要做的事情是通过计算\eqref{eq:nonlinear-maxwell-eq}的一些特解来获得通用的“看到泵浦光-写出输出光”的方法，这相当于我们在积掉整个光学系统，直接得到泵浦光的各个频率分量和输出的非线性谐波之间的关系。
所以其实可以采用量子场论中计算等效相互作用顶角的标准方法，即只计算连通图：设泵浦光包含$n$个（频率不同的）单频成分，微扰求解\eqref{eq:nonlinear-maxwell-eq}，只计算那些完全连通且正好包含$n$个\begin{tikzpicture}
    \begin{feynhand}
        \vertex[crossdot] (a) at (0, 0) {};
        \vertex (b) at (1, 0);
        \propag[photon] (a) to (b);
    \end{feynhand}
\end{tikzpicture}的图（后一个条件是为了保证我们计算的是$n$阶非线性过程，前一个条件是为了保证低于$n$阶的非线性过程没有被重复计数），这样可以得到形如$\alpha^{(n)} \vb*{E} \vb*{E} \cdots \vb*{E}$的响应，输出光就是
\[
    \vb*{E} = \int \dd{\omega} \alpha^{(1)}(\omega) \vb*{E}^\text{ext}(\omega) \ee^{-\ii \omega t} + \int \dd{\omega_1} \int \dd{\omega_2} \alpha^{(2)}(\omega_1 + \omega_2) : \vb*{E}^\text{ext}(\omega_1) \vb*{E}^\text{ext}(\omega_2) \ee^{-\ii (\omega_1 + \omega_2) t} + \cdots.
\]
请注意由于不存在圈图，每个$\alpha^{(n)}$中的图的数目是有限的，从而可以精确计算而不需要对圈数做截断等。

总之，虽然非线性光学问题比线性光学复杂上不少，我们仍然可以只计算泵浦光为若干个单频光叠加的情况，并且计算到给定的微扰阶数，这样足够提取到足够多的关于非线性光学体系的信息。

\subsection{例子：二阶非线性极化}

之前已经讨论过一个问题：具有两个频率分量的泵浦光被打入具有二阶非线性极化的材料中，计算和频光的强度。本节用非线性波动方程重新计算它。

\subsubsection{泵浦光无衰减时的一阶微扰}

我们考虑一个最为简单的情况：各向同性介质，泵浦光足够强，以至于在介质中泵浦光几乎没有衰减。
假定泵浦光中两个频率分量的光偏振方向均相同。取其波矢指向为$z$轴。
我们用$E_i$指代第$i$种傅里叶分量，用$A_i$表示其大小，即
\[
    E_i = \ee^{\ii k_i z - \ii \omega_i t} A_i + \ee^{- \ii k_i z + \ii \omega_i t} A_i^*.
\]
在线性光学中只取正频率或是负频率的分量不会造成任何问题，并且通常会让问题更加容易，但是我们现在在讨论非线性过程，因此$E$必须是实际的入射光，显然必须是实数。
这样，非线性极化导致的一阶微扰中%
\footnote{
    “阶”在本文中有两个意思，一个是非线性光学过程的阶数，$n$阶非线性光学过程就是$n$束光变成一束光；还有一个意思是微扰计算的阶数。
    前者描述单个顶角的粒子线数目，后者描述一张图中顶角的总数。
}%
，SFG过程给出修正
\[
    \left( \pdv[2]{z} - \frac{\epsilon_\text{r}}{c^2} \pdv[2]{t} \right) E_3 = \frac{1}{\epsilon_0 c^2} \pdv[2]{t} \left( 2 \epsilon_0  \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2) z} \ee^{-\ii \omega_3 t} \right) + \text{h.c.},
\]
其中我们设$\omega_3 = \omega_1 + \omega_2$，$\chi^{(2)}$指的是$\chi^{(2)}(\omega_3=\omega_1+\omega_2)$。
请注意没有什么能够保证线性极化是频率无关的——没有理由认为$\omega=\omega(k)$是线性的。
$E_3$的频率当然还是$\omega_3$。我们假定$E_3$大体上仍然是一个平面波，但是随着$z$增大，$A_3$会有变化。这样就有
\[
    \left( \pdv[2]{z} + 2 \ii k_3 \pdv{z} - k_3^2 + \frac{\epsilon_\text{r}}{c^2} \omega^2 \right) A_3 \ee^{\ii k_3 z - \ii \omega_3 t} = - \frac{\omega_3^2}{\epsilon_0 c^2} 2 \epsilon_0  \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2) z} \ee^{-\ii \omega_3 t} .
\]
由于色散关系可以不是线性的，从而$k_3$和$k_1 + k_2$完全可以不同。
上式左边括号中最后两项抵消了。再做慢变振幅近似（几何光学中就做了这一近似），就有
\[
    \pdv{z} A_3 = \frac{\ii \omega_3^2}{k_3 c^2} \chi^{(2)} A_1 A_2 \ee^{\ii (k_1 + k_2 - k_3) z}.
\]
求解这一方程，考虑到泵浦光中没有$E_3$分量，从而$z=0$处$A_3=0$，以及晶体厚度为$L$，就得到
\begin{equation}
    A_3(L) = \frac{\ii \chi^{(2)} \omega_3^2 A_1 A_2}{k_3 c^2} \left( \frac{\ee^{\ii \Delta k L} - 1}{\ii \Delta k} \right),
\end{equation}
其中
\begin{equation}
    \Delta k = k_1 + k_2 - k_3.
\end{equation}
$E_3$分量的强度是
\[
    I_3 = \expval*{\epsilon_0 n c E_3^2} = 2 \epsilon_0 n c \abs*{A_3}^2,
\]
于是就得到
\begin{equation}
    I_3 = \frac{8 \epsilon_0 (\chi^{(2)})^2 \abs*{A_1}^2 \abs*{A_2}^2 \omega_3^2}{nc} \frac{\sin^2(\Delta k L / 2)}{(\Delta k)^2} = \frac{(\chi^{(2)})^2 \omega_3^2 I_1 I_2}{2 \epsilon_0 c^3 n_1 n_2 n_3} \mathrm{sinc}^2 \left( \frac{\Delta k L}{2} \right) L^2.
    \label{eq:sfg-intensity}
\end{equation}

如果\concept{相位匹配条件}——即$k_3 = k_1 + k_2$——的确成立，那么$I_3$就稳定地随着$L^2$增大而线性增大，此时的SFG转换效率是非常高的。
当然，$L$大到一定程度时，$I_1$和$I_2$就开始随着$L$增大而下降，并且吸收也开始明显了。
大部分情况下相位匹配条件是没法成立的，因为色散非线性。此时随着$L$的增大，能量先是从$E_1$和$E_2$移向$E_3$模式，然后再从$E_3$模式移向$E_1$和$E_2$模式。
大约需要
\begin{equation}
    L_\text{coh} = \frac{1}{\Delta k}
\end{equation}
的距离可以看到明显的能量转移，这个长度称为\concept{相干长度}。
在$\Delta k$非零但不大——即所谓\concept{准相位匹配}——时，可以通过这样的方法获得高效率的SFG转换：将一系列能够发生非线性极化
PPLN装置

\section{极化的量子理论}

\end{document}