# 定义

虽然范畴论是抽象代数中提炼出来的概念，它实际上可以被当成一个独立的数学基础，诸如“$a$是$A$的成员”这种集合论概念实际上也可以只使用范畴论的语言定义出来。
我们不走得那么远，姑且在加入了排中律的归纳构造演算的框架下讨论范畴论。
这主要是因为范畴论作为数学基础的地位仍然受到很多质疑。范畴论的定义是“结构性”的，描述object和morphism的相互关系，而不是“断言性”的，断言什么存在什么不存在。
一个好的数学基础应该能够适当地编码各种结构，来保证它们的存在性，但是似乎很难在不引入集合的概念的情况下在范畴论中引入可以判断什么存在什么不存在的公理，那么我们甚至无法确定我们构造出来的范畴真的存在。

记$T$是一个$u$阶类型，`category T`定义为这样的一个结构：它的成员包括

- `Hom : T -> T -> Type v`
- `id : \Pi x : T, Hom T T`
- 

$\mathrm{Ob}(\mathcal{C})$给出$T$对应的集合（这里的“集合”一词的意义是构造演算中的类型对应的可以做并、交、差的那种结构，包括但不限于ZFC定义的集合；很多时候——如在讨论所谓“集合范畴”，即以集合为对象以映射为态射的范畴时——$\mathrm{Ob}(\mathcal{C})$对于一般的集合论来说是太“大”了，它们也许更加应该称为class而不是set），其中的诸元素称为**对象**；设$A, B$是两个对象，$\mathrm{Hom}_{\mathcal{C}}(A, B)$（或者有时$\mathrm{Mor}_{\mathcal{C}}(A, B)$，虽然本文用$\mathrm{Mor}(\mathcal{C})$表示范畴$\mathcal{C}$中的所有态射）给出`Hom(A, B)`对应的集合，其中的诸元素称为**态射**。
一般$\mathcal{C}$是$\mathrm{Hom}_{\mathcal{C}}(A, B)$的隐藏参数，通常从上下文推断出来。
通常，除非$A=A'$，$B=B'$，我们认为$\mathrm{Hom}(A, B)$和$\mathrm{Hom}(A', B')$不相交。实际上，如果它们相交，我们总是可以将$A$和$B$的信息添加到每个态射上，从而让$\mathrm{Hom}(A, B)$和$\mathrm{Hom}(A', B')$不相交。
若$f \in \mathrm{Hom}(A, B)$，设$\mathrm{src}(f) = A$，$\mathrm{tar}(f) = B$。

$\mathrm{Hom}(A, B)$中的态射可以记作$A \to B$，彼此为**平行箭头**。虽然使用了这样的记号，还是要强调$f: A \to B$在范畴论中不意味着$f$一定是一个映射。

$\mathrm{id}_A$为$A$到其自身的单位元态射。单位元——满足$i \circ f = f, f \circ i = f$的$i$——是唯一的。

`category T`的阶数为$\max(u, v + 1)$。一个范畴是**small**的当且仅当对象和态射在同一阶宇宙中；否则这个范畴就是**large**的。
范畴大小的概念可以进一步细化，如指出他们在哪个宇宙上。

范畴可以容易地画成图：对象就是点，态射就是线。如果一个范畴图中首尾相同的任意两条路径上的态射做复合，得到的结果都是相等的，那么这个图就是**交换图**。
作为一个例子，我们有所谓**集合范畴**Set，其中每个对象看成一个集合而将态射看成集合之间的映射。
但是需要注意的是态射也可以不是映射：如我们也可以建立另一个范畴，其中对象是集合，但是从$A$到$B$的态射未必在$A$的每一个成员上都有定义。只需要满足结合律、单位元存在等性质，就可以。

交换图：两个图如果共享一条边，分别都是交换的，那么它们组合而成的图也是交换的。贡献一个点也可以，但是多个点不行。。

关于范畴的大小：“局部小”指的是态射的“集合”比较“小”

# 态射和范畴中的部件

范畴中的**部件（widget）**指的是范畴图的某个具有神奇性质的子图。

## 态射和等价关系

- retraction: 有右逆的态射，即设$f:X \to Y$，当且仅当$\exists g : Y \to X, f \circ g = \mathrm{id}_Y$时$f$是retraction；也可以说，retraction是某个态射的左逆；又称split epimorphism
- section: 有左逆的态射，即设$f:X \to Y$，当且仅当$\exists g : Y \to X, g \circ f = \mathrm{id}_X$时$f$是section；也可以说，section是某个态射的右逆；又称split monomorphism
- isomorphism: 同时有左逆和右逆的态射，即同时是retraction和section的态射；它可以*不是*唯一的
- monomorphism: 可以左消去的态射，单射的范畴论推广；section都是monomorphism，但是反之不然；原因也是很明显的，因为对范畴$\mathcal{C}$中的section$f$，我们总是可以将它的左逆从态射中移除，同时移除一些别的态射来保证移除后仍然可以得到一个范畴，在新范畴中$\mathcal{C}'$中$f$仍然是一个monomorphism（因为新范畴中的态射只是原范畴的一个子集，既然$f$在$\mathrm{Mor}(\mathcal{C})$中是可以左消去的，它在$\mathrm{Mor}(\mathcal{C}')$中当然也是可以左消去的），但是已经没有左逆了
- epimorphism: 可以右消去的态射，满射的范畴论推广；retraction都是epimorphism，但是反之不然，原因同上
- bimorphism: 同时是monomorphism和epimorphism的态射；一个isomorphism一定是bimorphism，但是反之不然，原因同样是“逆总是可以被移除”。一个bimorphism$f$不是isomorphism意味着$f$没有保持在$\mathcal{C}$中我们希望保留的结构，即$f$可能的逆出于某些原因，不能出现在$\mathcal{C}$中。在$\mathcal{C}$中的态射太少（bimorphism的逆被直接排除在$\mathcal{C}$外了）或者太多（新加入的biomorphism找不到逆）时都会出现bimorphism不是isomorphism的现象，因此如果每个bimorphism都是isomorphism，这意味着$\mathcal{C}$中的态射不多也不少，此时我们称$\mathcal{C}$为**平衡范畴**

我们很少真的去讨论两个对象是不是相等，但是我们的确有时会讨论$\mathrm{Hom}(X, Y)$中的两个态射是不是相等。
虽然等价关系是抽象代数中占据支配地位的概念，“相等”还是有必要出现的，因为有时我们需要讨论唯一性。
实际上这暗示了一点，就是范畴论中我们实际上根本没法具体地讨论对象的内部结构，从而也无法比较两个对象，等等；我们能够具体操作的其实是态射。

两个对象之间同构记作$\simeq$

如果我们将态射看成一个更大的范畴中的对象，那么实际上也可以绕过“态射相等”。这是高阶范畴中讨论的话题。

## initial object and terminal object

**initial object**是这样一个对象$I$，对任意对象$X$，$I \to X$的态射只有一个。
**terminal object**是这样一个对象$I$，对任意对象$X$，$X \to I$的态射只有一个。
同时是initial object和terminal object的对象是**null object**或者说**zero object**。

一个范畴中可以没有initial object或者terminal object，但是如果有的话，可以证明，它们在isomorphism意义下是唯一的，并且两个initial object之间的态射有且仅有一个，这个态射是它们之间的一个isomorphism。

通常将initial object记作0，而将terminal object记作1，因为在冯诺依曼序数中$0$是空集，可以认为空集到任何集合的映射都只有一个（当然实际上此时根本没法用二元对定义映射，这也只是一个side case）；$1$是单元素集合（只有一个元素，就是空集），那么从任何集合到1的映射只有一个。
于是在集合范畴中冯诺依曼序数0是initial object而序数1是terminal object。

## 元素

从terminal object到各个object的态射给出了各个object的“内容”。如果object是一个集合，那么这是显然的。
于是我们称从一个terminal object $T$到$X$的态射的全体为$X$的（$T$-valued）**element**。

乍一看这会产生疑难，因为没有什么规定态射一定是集合到集合的映射，那么我们将所有态射的箭头方向反过来，似乎也可以定义各个object的“内容”；但是实际上这并没有产生疑难，因为将态射箭头反过来这个操作要有意义通常是在做范畴的对偶，那么此时的1-object已经变成了0-object。

$X$的$T$-valued **generalized element**或者$T$-valued **generalized point**是全体morphism$T \to X$。
比如说对集合范畴，如果$T$是一个二元集合，那么$T$-valued generalized points of $X$就是$X$中的所有二元组。

## product and sum

首先考虑所谓笛卡尔积的范畴论推广。一个pair$(a, b)$中的全部信息可以用映射$(a, b) \mapsto a$和$(a, b) \mapsto b$提取出来，因此其范畴论推广应该是一个三元组$(O, \pi_1, \pi_2)$，其中$\pi_1: O \to X$, $\pi_2: O \to Y$。
然而，这样还不够，因为完全可以想象$O$内部保存了一系列三元组（或者更大的结构），而不是二元组，因此我们还需要一个条件来确保$O$包含的信息是“最少的”，这就是说，如果另一个对象$S$也有到$X$和$Y$的态射，那么存在一种方法能够将$S$“约化”到$O$上，并且由于$O$是最小的，这种约化方法应该是唯一的。
因此我们有以下定义：

对象$X$和$Y$的**直积**是一个三元组$(O, \pi_1, \pi_2)$，其中$\pi_1: O \to X$, $\pi_2: O \to Y$，且对任意对象$S$，若存在$p_1 : S \to X$和$p_2 : S \to Y$，则存在一个唯一的从$S$到$O$的态射$f$使得$p_1 = \pi_1 \circ f$，且$p_2 = \pi_2 \circ f$。

两个对象不一定有直积，可能是因为可能的直积并没有被包含在范畴中，也可能是因为可用的态射太少，不足够定义一个直积。但是，$X$和$Y$的所有直积都是同构的。
此外，如果有terminal object $1$，那么$1 \times X \simeq X \simeq X \times 1$，且对$X, Y, Z$，它们对$\simeq$满足交换律、结合律。
需要注意的是即使$0 \times X$存在，它也未必和$0$同构。

相应地可以定义直和，这是直积的对偶，在编程中直积对应着结构体，而直和对应着共用体。容易发现直和实际上就是直积的对偶：

对象$X$和$Y$的**直和**是一个三元组$(O, \alpha_1, \alpha_2)$，其中$\alpha_1: X \to O$, $\alpha_2: Y \to O$，且对任意对象$S$，若存在$p_1 : X \to S$和$p_2 : Y \to S$，则存在一个唯一的从$O$到$S$的态射$f$使得$p_1 = f \circ \alpha_1$，且$p_2 = f \circ \alpha_2$。

直和和直积可以推广到一组对象上：一组对象$\{X_i\}$的直积是一个

直积中涉及一种很常见的部件：wedge，由$O, X, Y$以及一个从$O$指向$X$的箭头和一个从$O$指向$Y$的箭头组成。
它的对偶是corner，箭头方向正好相反。

# 范畴生范畴

子范畴：对象和态射都是子集

全子范畴：设$\mathcal{D}$是$\mathcal{C}$的子范畴，如果$\mathcal{D}$的任意两个对象$A, B$都满足$\mathrm{Hom}_\mathcal{C}(A, B) = \mathrm{Hom}_\mathcal{D}(A, B)$，那么$\mathcal{D}$就是$\mathcal{C}$的一个**全子范畴**。
直观地看，全子范畴把能保留的态射都保留下来了。

# 函子和自然变换

## 函子

**协变函子 functor**$F:\mathcal{C} \to \mathcal{C}'$是这样一个结构，它包含：

- 从$\mathrm{Ob}(\mathcal{C})$到$\mathrm{Ob}(\mathcal{C}')$的映射$F_{\mathcal{C}}^\text{ob}$，设$X \in \mathrm{Ob}(\mathcal{C})$，将$F_{\mathcal{C}}^\text{ob}(\mathcal{C})$简记为$F(X)$
- 对$X, Y \in \mathrm{Ob}(\mathcal{C})$，从$\mathrm{Hom}(X, Y)$到$\mathrm{Hom}(F_{\mathcal{C}}^\text{ob}(X), F_{\mathcal{C}}^\text{ob}(Y))$的一个映射$F^\text{mor}_{\mathcal{C}, X, Y}$；设$f$是一个态射，$F^\text{mor}_{\mathcal{C}, X, Y}(f)$简记为$F(f)$
- 保持单位元不变，即$F(\mathrm{id}_X) = \mathrm{id}_{F(X)}$
- 保持态射结构，即$F(g \circ f) = F(g) \circ F(f)$

“协变”的名称很好理解：函子没有改变态射的方向。有时有些从范畴到范畴的映射将态射的方向全部反过来了，此时的函子称为**逆变函子**。

函子的复合还是函子。两个逆变函子的复合是协变函子，一个协变函子和一个逆变函子的复合是逆变函子。

函子作用下，一个交换图被映射为另一个交换图，一个isomorphism被映射为另一个isomorphism。

最简单的协变函子是$\mathrm{Id}$，它将一个范畴映射到其自身。最简单的逆变函子是**对偶运算**，记作$\mathcal{C}^\text{op}$，它保持所有对象不变，但是将所有函子的方向反过来，即：

$$
\mathrm{Ob}(\mathcal{C}^\text{op}) = \mathrm{Ob}(\mathrm{C}), \quad (f \circ g)^\text{op} = g^\text{op} \circ f^\text{op}.
$$
很容易看出，如果将一个范畴论定理中所有的东西——范畴，对象，态射——都换成其对偶，那么得到的命题仍然成立。
$\mathcal{C} \to \mathcal{D}$的逆变函子就是$\mathcal{C}^\text{op} \to \mathcal{D}$的协变函子；一个范畴的对偶的对偶就是它本身。

函子$F:\mathcal{C} \to \mathcal{D}$是**满函子**，当且仅达对任意$X, Y \in \mathrm{Ob}(\mathcal{C})$，$F^\text{mor}_{\mathcal{C}, X, Y}$是满射。
满函子不会向$\mathcal{D}$中加入任何新的结构，但是可能破坏$\mathcal{C}$中已有的结构。
反之，函子$F:\mathcal{C} \to \mathcal{D}$是**忠实函子**，当且仅达对任意$X, Y \in \mathrm{Ob}(\mathcal{C})$，$F^\text{mor}_{\mathcal{C}, X, Y}$是单射，忠实函子将$\mathcal{C}$中用$\mathcal{D}$中的对象能够表示的全部的结构保留到了$\mathcal{D}$中，但是可能增加新的结构。
既满又忠实的函子就是**全忠实函子**，也称为**embedding**。
需要注意的是全忠实函子的对象部分未必是双射，它只是保留了能保留的全部态射，却完全可以不保留所有对象。
如果从范畴$\mathcal{C}$到范畴$\mathcal{D}$有一个嵌入函子，那么直观地看，我们可以从$\mathcal{D}$中圈出一部分点，使这些点连通它们之间的态射和$\mathcal{C}$同构。

“稠密”函子：$F:\mathcal{C} \to \mathcal{D}$是**稠密**的，当且仅达，对任意$\mathcal{D}$中对象$Z$，存在$\mathcal{C}$中对象$X$，使得$Z \simeq F(X)$。
如果从$\mathcal{C}$到$\mathcal{D}$有一个稠密函子，直观地看，使用$\mathcal{C}$可以把$\mathcal{D}$中的所有对象覆盖到：$\mathcal{D}$中所有彼此同构的对象都可以用$\mathcal{C}$中的一个对象代表。

从子范畴到原范畴有**包含函子**，包含函子一定是忠实的（显然）。显然，子范畴是全子范畴当且仅达它到原范畴的包含函子是满函子（从而是全忠实函子）。

从函子出发自然可以定义**同构**，函子$F: \mathcal{C} \to \mathcal{D}$是同构，当且仅当它是嵌入函子，并且它在对象上是双射。

TODO：以上的定义实际上局限在一个特殊的范畴中，这个范畴以所有小范畴的集合为对象，以真正的映射为态射。

## 范畴的等价

范畴的同构实际上是非常强的条件，它要求两个范畴$\mathcal{C}$和$\mathcal{D}$之间的对象和态射是一一对应的。
然而，如果$\mathcal{D}$比$\mathcal{C}$多出来了一些对象，但是所有多出来的对象都和某个可以对应到$\mathcal{C}$中的某个对象的对象同构，那么在某种意义上仍然可以认为$\mathcal{C}$和$\mathcal{D}$“是一样的”。
即使$\mathcal{C}$和$\mathcal{D}$都多出来了一些对象，如果能够把这些对象联系到某些等价的、在$\mathcal{C}$和$\mathcal{D}$之间可以一一对应的对象上，我们也可以认为它们是“一样的”。

更加清楚地，两个范畴在以上意义下是一样的，当且仅当，把两个范畴中等价的对象全部删掉，剩下来的“骨架”同构。
于是我们首先定义骨架，然后定义这种“一样性”。

TODO：骨架应该一定存在吧……

一个范畴是骨架，当且仅当，这个范畴中的所有等价关系都是$A \to A$型的：两个不同的对象之间没有等价关系。
范畴$\mathcal{C}$的**骨架**$\mathcal{C}_0$是它的一个子范畴，满足：$\mathcal{C}_0$是一个骨架，且存在一个嵌入、稠密的$\mathcal{C}_0 \to \mathcal{C}$函子。
容易证明一个范畴的所有骨架都彼此同构。

两个范畴**等价**，当且仅当，它们的骨架同构。显然一个范畴和它的骨架是等价的。

容易证明，两个范畴等价，当且仅当，存在从它们中的一个到另一个的嵌入、稠密的函子。只需要构造适当的关于对象的态射就可以证明这一点。

实际上，等价性相对于同构性可能是更加好的“范畴一样”的定义，因为后者实在是过于严格了。

## 自然变换

范畴中的对象可以有关系，范畴之间可以有关系，函子之间当然也可以有关系。
为了获得motivation首先考虑两个函子什么时候可以称为“一样的”。

首先，协变函子和逆变函子之间肯定是“不一样”的，于是以下只讨论协变函子，而逆变函子的情况可以通过对偶自动地得出。
设$F, G : \mathcal{C} \to \mathcal{D}$是两个协变函子。如果我们认为$F$和$G$要“一样”，首先肯定要求对每个$X \in \mathrm{Ob}(\mathcal{C})$，$FX$和$GX$在$\mathcal{D}$中应该能够建立同构关系。
设$\psi_X$是这个$FX$到$GX$的同构态射，设$\psi$为$X \mapsto \psi_X$。
不过这样还不够，我们还需要将任意的$f:A\to B, A, B \in \mathrm{Ob}(\mathcal{C})$在$\mathcal{D}$中的像$Ff$和$Gf$之间建立关系。
当然，一个比较弱的假设是要求$F$和$G$作用后的态射集合同构，但是这样不“自然”：我们还希望能够从$Ff$能够计算出$Gf$。
既然现在我们有
$$
FA \stackrel{Ff}{\longrightarrow} FB \stackrel{\psi_B}{\longrightarrow} GB,
$$
以及
$$
FA \stackrel{\psi_A}{\longrightarrow} FB \stackrel{Gf}{\longrightarrow} GB,
$$
那么最自然的想法就是假定以上两个链组成的图交换，也即
$$
\psi_B \circ Ff = \psi_A \circ Gf.
$$

于是我们就得到**自然同构**的定义：设$F, G : \mathcal{C} \to \mathcal{D}$是两个协变函子，$\psi$是从$\mathrm{Ob}(\mathcal{C})$到$\mathcal{D}$上的同构的一个映射，$\psi$是$F$到$G$的**自然同构**，当且仅当，对任意$X \in \mathrm{Ob}(\mathcal{C})$，$\psi_X$是$FX$到$GX$的同构，且对任意$A, B \in \mathrm{Ob}(\mathcal{C})$，以及$f:A \to B$，我们有
$$
\psi_B \circ Ff = \psi_A \circ Gf.
$$
如果$F$和$G$之间有一个自然同构，那么就说它们自然同构，记作$F \simeq G$。
设$A$是$\mathcal{C}$的对象，$F$和$G$自然同构，则称$FA$和$GA$自然地同构。

很多时候，也许$F$和$G$之间并没有自然同构那么强的关系。做以下定义：
设$F, G : \mathcal{C} \to \mathcal{D}$是两个协变函子，$\psi$是从$\mathrm{Ob}(\mathcal{C})$到$\mathcal{D}$上的*态射*的一个映射，$\psi$是$F$到$G$的**自然变换**，当且仅当，对任意$X \in \mathrm{Ob}(\mathcal{C})$，$\psi_X$是$FX$到$GX$的态射，且对任意$A, B \in \mathrm{Ob}(\mathcal{C})$，以及$f:A \to B$，我们有
$$
\psi_B \circ Ff = \psi_A \circ Gf.
$$

回过头来看，自然变换的意义其实非常清楚：它意味着，$F$和$G$作用后，态射的结合被保留了：每个$Ff$可以对应到一个$Gf$上面，然后$Ff \circ Fg$可以被对应到$Gf \circ Gg$上面。（请注意我们只能够保证$G(f \circ g) = Gf \circ Gg$，但是不能保证如果$Ff$和$Gf$能对应上，$Fg$和$Gg$能够对应上，没有什么保证在同样的对应规则下，$F(f \circ g)$能对应到$G(f \circ g)$上）

可以用$F \stackrel{\psi}{\Rightarrow} G$表示一个自然变换。

自然变换也可以复合。例如，设有$F \stackrel{\psi_1}{\Rightarrow} G$，$G \stackrel{\psi}{\Rightarrow} H$均为自然复合，

# 高阶范畴

我们已经看到了从范畴获得“更大的”范畴的方法了：将态射当成新范畴中的对象，然后定义态射间的态射，如此重复。
这里要特别避免构造包含自身的范畴这种东西，因为它很容易触发罗素悖论，从而在大部分数学基础中都会被某条公理禁止。

# 与类型论的关系

可以看到范畴和高阶范畴具有一系列特征：

- 结合律始终成立，从而“沿着态射从一个点走到另一个点”的图像总是适用的
- 分层，即用自然数标记一个范畴的等级来避免罗素悖论
- 对象总是放在范畴中讨论的，很少讨论不同范畴中的对象是否相等

另一方面，现代的**类型论**通常是

- 无副作用，自然演绎风格
- 分层，即使用自然数标记类型宇宙来避免罗素悖论
- term总是有类型标签的

于是可以看到范畴论是类型论的语义。

